import streamlit as st
import random
import plotly.graph_objects as go
import pandas as pd

# â”€â”€ Page config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="Salary Cost Model", layout="wide")
st.title("Salary Cost Model")
st.markdown("*Modeling total salary bill with legacy promotions, restructuring, and long-term cost trajectory*")
st.markdown("---")

# â”€â”€ Simulation engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def run_salary_sim(
    # Initial team
    initial_senior_ii,
    initial_seniors,
    legacy_eligible_now,       # promote immediately
    legacy_eligible_in_months, # promote at this month
    sim_years,
    # Fixed salaries
    junior_salary,
    senior_salary,
    senior_ii_salary,
    # Raises
    annual_raise_pct,
    # Post-restructuring rules
    new_eligibility_months,
    senior_cap_pct,
    # Resignations by year
    senior_ii_resignations_by_year,
    senior_resignations_by_year,
    junior_resignations_by_year,
    # Hiring delay
    new_hire_delay_months,
    seed=1
):
    random.seed(seed)
    sim_months = sim_years * 12

    # â”€â”€ Initialize staff â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    staff = []
    uid = 0
    restructuring_month = None

    for i in range(initial_senior_ii):
        staff.append({
            "id": uid, "role": "senior_ii",
            "salary": senior_ii_salary,
            "joined_month": -random.randint(12, 60),
            "eligible_month": None,
            "legacy": False,
            "status": "active"
        })
        uid += 1

    for i in range(initial_seniors):
        staff.append({
            "id": uid, "role": "senior",
            "salary": senior_salary,
            "joined_month": -random.randint(12, 60),
            "eligible_month": None,
            "legacy": False,
            "status": "active"
        })
        uid += 1

    # Legacy juniors already eligible â€” promote at month 0
    for i in range(legacy_eligible_now):
        staff.append({
            "id": uid, "role": "junior",
            "salary": junior_salary,
            "joined_month": -18,  # already hit 18 months
            "eligible_month": 0,  # eligible immediately
            "legacy": True,
            "status": "active"
        })
        uid += 1

    # Legacy juniors becoming eligible at specified month
    if legacy_eligible_in_months > 0:
        staff.append({
            "id": uid, "role": "junior",
            "salary": junior_salary,
            "joined_month": -18 + legacy_eligible_in_months,
            "eligible_month": legacy_eligible_in_months,
            "legacy": True,
            "status": "active"
        })
        uid += 1

    total_legacy = legacy_eligible_now + (1 if legacy_eligible_in_months > 0 else 0)

    # â”€â”€ Generate resignation events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    def resignation_months_for_year(year_index, count):
        year_start = year_index * 12
        year_end = year_start + 12
        if count == 0:
            return []
        return sorted(random.sample(range(year_start, year_end), min(count, 12)))

    sii_resign_months    = []
    senior_resign_months = []
    junior_resign_months = []
    for y in range(sim_years):
        sii_resign_months.extend(resignation_months_for_year(y, senior_ii_resignations_by_year[y] if y < len(senior_ii_resignations_by_year) else 0))
        senior_resign_months.extend(resignation_months_for_year(y, senior_resignations_by_year[y] if y < len(senior_resignations_by_year) else 0))
        junior_resign_months.extend(resignation_months_for_year(y, junior_resignations_by_year[y] if y < len(junior_resignations_by_year) else 0))

    # â”€â”€ Tracking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    history = []
    events = []
    open_promotion_slots = 0
    pending_hires = []

    # â”€â”€ Month by month simulation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    for month in range(sim_months):

        # Annual raises
        if month > 0 and month % 12 == 0:
            for s in staff:
                if s["status"] == "active":
                    s["salary"] *= (1 + annual_raise_pct / 100)
            events.append({"month": month, "event": f"Annual raise applied ({annual_raise_pct}%)"})

        # Process pending hires
        for hire in pending_hires[:]:
            if hire["available_month"] <= month:
                staff.append({
                    "id": uid, "role": "junior",
                    "salary": junior_salary,
                    "joined_month": month,
                    "eligible_month": month + new_eligibility_months,
                    "legacy": False,
                    "status": "active"
                })
                uid += 1
                pending_hires.remove(hire)
                events.append({"month": month, "event": f"New junior hire joined (eligible month {month + new_eligibility_months})"})

        # Active staff
        active = [s for s in staff if s["status"] == "active"]
        juniors = [s for s in active if s["role"] == "junior"]
        legacy_remaining = [s for s in juniors if s["legacy"]]

        # Check restructuring trigger
        if restructuring_month is None and total_legacy > 0 and len(legacy_remaining) == 0 and month > 0:
            restructuring_month = month
            events.append({"month": month, "event": f"â­ RESTRUCTURING â€” all legacy juniors promoted or departed. Senior cap ({int(senior_cap_pct*100)}%) and {new_eligibility_months}-month eligibility now apply."})

        # Promotions
        eligible_juniors = sorted(
            [s for s in juniors if s["eligible_month"] is not None and s["eligible_month"] <= month],
            key=lambda s: s["eligible_month"]
        )

        if restructuring_month is None:
            # Before restructuring: promote all eligible legacy juniors immediately, no cap check
            for candidate in [s for s in eligible_juniors if s["legacy"]]:
                candidate["role"] = "senior"
                candidate["salary"] = senior_salary
                candidate["eligible_month"] = None
                candidate["legacy"] = False
                events.append({"month": month, "event": f"Legacy junior promoted to Senior (salary: ${senior_salary:,.0f})"})
        else:
            # After restructuring: cap applies, slots needed
            while open_promotion_slots > 0 and eligible_juniors:
                candidate = eligible_juniors.pop(0)
                candidate["role"] = "senior"
                candidate["salary"] = senior_salary
                candidate["eligible_month"] = None
                open_promotion_slots -= 1
                events.append({"month": month, "event": f"Junior promoted to Senior (salary: ${senior_salary:,.0f})"})

        # Senior II resignations â€” replaced by junior
        if month in sii_resign_months:
            active_sii = [s for s in staff if s["status"] == "active" and s["role"] == "senior_ii"]
            if active_sii:
                leaver = random.choice(active_sii)
                leaver["status"] = "resigned"
                events.append({"month": month, "event": f"Senior II resigned (salary was ${leaver['salary']:,.0f})"})
                pending_hires.append({"available_month": month + new_hire_delay_months})

        # Senior resignations â€” replaced by junior, may open promotion slot
        if month in senior_resign_months:
            active_seniors = [s for s in staff if s["status"] == "active" and s["role"] == "senior"]
            if active_seniors:
                leaver = random.choice(active_seniors)
                leaver["status"] = "resigned"
                events.append({"month": month, "event": f"Senior resigned (salary was ${leaver['salary']:,.0f})"})
                pending_hires.append({"available_month": month + new_hire_delay_months})
                # Only open promotion slot after restructuring
                if restructuring_month is not None:
                    current_seniors = len([s for s in staff if s["status"] == "active" and s["role"] == "senior"])
                    current_total = len([s for s in staff if s["status"] == "active"])
                    if current_seniors <= int(current_total * senior_cap_pct):
                        open_promotion_slots += 1
                        events.append({"month": month, "event": "Promotion slot opened"})

        # Junior resignations â€” replaced by junior
        if month in junior_resign_months:
            active_juniors = [s for s in staff if s["status"] == "active" and s["role"] == "junior"]
            if active_juniors:
                non_legacy = [s for s in active_juniors if not s["legacy"]]
                leaver = random.choice(non_legacy if non_legacy else active_juniors)
                was_legacy = leaver["legacy"]
                leaver["status"] = "resigned"
                events.append({"month": month, "event": f"{'Legacy junior' if was_legacy else 'Junior'} resigned (salary was ${leaver['salary']:,.0f})"})
                pending_hires.append({"available_month": month + new_hire_delay_months})

        # Monthly snapshot
        active      = [s for s in staff if s["status"] == "active"]
        sii_now     = [s for s in active if s["role"] == "senior_ii"]
        seniors_now = [s for s in active if s["role"] == "senior"]
        juniors_now = [s for s in active if s["role"] == "junior"]
        legacy_now  = [s for s in juniors_now if s["legacy"]]

        history.append({
            "month": month,
            "year": month // 12 + 1,
            "month_of_year": month % 12 + 1,
            "n_senior_ii": len(sii_now),
            "n_seniors": len(seniors_now),
            "n_juniors": len(juniors_now),
            "n_legacy": len(legacy_now),
            "total_staff": len(active),
            "senior_ii_cost": sum(s["salary"] for s in sii_now),
            "senior_cost": sum(s["salary"] for s in seniors_now),
            "junior_cost": sum(s["salary"] for s in juniors_now),
            "total_cost": sum(s["salary"] for s in active),
        })

    return pd.DataFrame(history), events, restructuring_month


# â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.sidebar.header("Simulation Controls")

st.sidebar.subheader("ğŸ‘¥ Initial Team")
initial_senior_ii        = st.sidebar.number_input("Initial Senior IIs", 0, 20, 2)
initial_seniors          = st.sidebar.number_input("Initial Seniors", 0, 20, 9)
st.sidebar.markdown("**Legacy Juniors**")
legacy_eligible_now      = st.sidebar.number_input("Already eligible (promote immediately)", 0, 10, 2)
legacy_eligible_in       = st.sidebar.number_input("Eligible in X months", 0, 24, 6)
total_team = int(initial_senior_ii) + int(initial_seniors) + int(legacy_eligible_now) + (1 if legacy_eligible_in > 0 else 0)
st.sidebar.caption(f"Total team: {total_team} staff")

st.sidebar.subheader("ğŸ“… Simulation Length")
sim_years = st.sidebar.slider("Simulation Length (years)", 1, 10, 5)

st.sidebar.subheader("ğŸ’° Fixed Salaries")
junior_salary    = st.sidebar.number_input("Junior Starting Salary ($)", 0, 500000, 75000, step=1000)
senior_salary    = st.sidebar.number_input("Senior Salary at Promotion ($)", 0, 500000, 120000, step=1000)
senior_ii_salary = st.sidebar.number_input("Senior II Salary ($)", 0, 500000, 150000, step=1000)

st.sidebar.subheader("ğŸ“ˆ Annual Raise")
annual_raise_pct = st.sidebar.slider("Annual Raise (%)", 0.0, 10.0, 3.0, step=0.5)

st.sidebar.subheader("âš™ï¸ Post-Restructuring Rules")
new_eligibility = st.sidebar.slider("New Promotion Eligibility (months)", 6, 60, 30)
senior_cap_pct  = st.sidebar.slider("Senior Cap (% of team)", 10, 90, 50) / 100
st.sidebar.caption(f"Senior cap = {int(total_team * senior_cap_pct)} of {total_team} staff")

st.sidebar.subheader("ğŸ“‰ Senior II Resignations by Year")
sii_res = []
for y in range(sim_years):
    val = st.sidebar.number_input(f"Year {y+1}", 0, 5, 0, key=f"sii_{y}")
    sii_res.append(int(val))

st.sidebar.subheader("ğŸ“‰ Senior Resignations by Year")
senior_res = []
for y in range(sim_years):
    val = st.sidebar.number_input(f"Year {y+1} ", 0, 10,
                                   2 if y == 0 else (1 if y == 1 else 0),
                                   key=f"sr_{y}")
    senior_res.append(int(val))

st.sidebar.subheader("ğŸ“‰ Junior Resignations by Year")
junior_res = []
for y in range(sim_years):
    val = st.sidebar.number_input(f"Year {y+1}  ", 0, 10, 0, key=f"jr_{y}")
    junior_res.append(int(val))

st.sidebar.subheader("ğŸ¢ Hiring")
new_hire_delay = st.sidebar.slider("New Hire Start Delay (months)", 0, 12, 3)

st.sidebar.subheader("ğŸ² Randomization")
seed = st.sidebar.slider("Seed", 1, 100, 1)

# â”€â”€ Run simulation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

df, events, restructuring_month = run_salary_sim(
    initial_senior_ii=int(initial_senior_ii),
    initial_seniors=int(initial_seniors),
    legacy_eligible_now=int(legacy_eligible_now),
    legacy_eligible_in_months=int(legacy_eligible_in),
    sim_years=sim_years,
    junior_salary=junior_salary,
    senior_salary=senior_salary,
    senior_ii_salary=senior_ii_salary,
    annual_raise_pct=annual_raise_pct,
    new_eligibility_months=new_eligibility,
    senior_cap_pct=senior_cap_pct,
    senior_ii_resignations_by_year=sii_res,
    senior_resignations_by_year=senior_res,
    junior_resignations_by_year=junior_res,
    new_hire_delay_months=new_hire_delay,
    seed=seed
)

# â”€â”€ Summary metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.subheader("Cost Summary")

start_cost = df.iloc[0]["total_cost"]
end_cost   = df.iloc[-1]["total_cost"]
peak_cost  = df["total_cost"].max()
low_cost   = df["total_cost"].min()
delta_pct  = (end_cost - start_cost) / start_cost * 100

col1, col2, col3, col4, col5 = st.columns(5)
col1.metric("Starting Annual Bill", f"${start_cost:,.0f}")
col2.metric("Ending Annual Bill",   f"${end_cost:,.0f}",
            delta=f"{delta_pct:+.1f}%", delta_color="inverse")
col3.metric("Peak Annual Bill",     f"${peak_cost:,.0f}")
col4.metric("Lowest Annual Bill",   f"${low_cost:,.0f}")
col5.metric("Restructuring",
            f"Month {restructuring_month} (Yr {restructuring_month // 12 + 1})" if restructuring_month else "Not triggered",
            delta=None)

if restructuring_month:
    st.success(f"âœ… Restructuring triggered at month {restructuring_month} â€” all legacy juniors promoted or departed. New {new_eligibility}-month eligibility and {int(senior_cap_pct*100)}% senior cap now apply.")
else:
    st.warning("âš ï¸ Restructuring not yet triggered â€” legacy juniors still in pipeline. Consider extending the simulation length.")

st.markdown("---")

# â”€â”€ Chart 1: Total salary bill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.subheader("Total Annual Salary Bill Over Time")

fig1 = go.Figure()
fig1.add_trace(go.Scatter(
    x=df["month"], y=df["senior_ii_cost"],
    name="Senior II", mode="lines",
    line=dict(color="#9b7eb8", width=2),
    fill="tozeroy", fillcolor="rgba(155,126,184,0.15)",
    hovertemplate="Month %{x}<br>Senior II: $%{y:,.0f}<extra></extra>"
))
fig1.add_trace(go.Scatter(
    x=df["month"], y=df["senior_ii_cost"] + df["senior_cost"],
    name="+ Seniors", mode="lines",
    line=dict(color="#c9a84c", width=2),
    fill="tonexty", fillcolor="rgba(201,168,76,0.15)",
    hovertemplate="Month %{x}<br>Senior II + Senior: $%{y:,.0f}<extra></extra>"
))
fig1.add_trace(go.Scatter(
    x=df["month"], y=df["total_cost"],
    name="Total", mode="lines",
    line=dict(color="#e8e4d9", width=2),
    fill="tonexty", fillcolor="rgba(126,184,201,0.15)",
    hovertemplate="Month %{x}<br>Total: $%{y:,.0f}<extra></extra>"
))

if restructuring_month:
    fig1.add_vline(x=restructuring_month, line_width=2, line_color="#e8734a",
                   line_dash="dash", annotation_text="Restructuring",
                   annotation_position="top", annotation_font_color="#e8734a")

for y in range(1, sim_years + 1):
    fig1.add_vline(x=y * 12, line_width=1, line_color="#2a2a3a",
                   annotation_text=f"Yr {y}", annotation_position="top")

fig1.update_layout(
    paper_bgcolor="#0f0f14", plot_bgcolor="#0f0f14",
    font=dict(color="#e8e4d9", family="Georgia"),
    xaxis=dict(title="Month", gridcolor="#2a2a3a", tickfont=dict(size=10)),
    yaxis=dict(title="Annual Salary Cost ($)", gridcolor="#2a2a3a", tickformat="$,.0f"),
    legend=dict(bgcolor="#1a1a24", bordercolor="#2a2a3a"),
    height=420, margin=dict(l=80, r=20, t=40, b=40),
    hoverlabel=dict(bgcolor="#1a1a24"),
)
st.plotly_chart(fig1, use_container_width=True)

# â”€â”€ Chart 2: Team composition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.subheader("Team Composition Over Time")

fig2 = go.Figure()
fig2.add_trace(go.Scatter(
    x=df["month"], y=df["n_senior_ii"],
    name="Senior II", mode="lines",
    line=dict(color="#9b7eb8", width=2),
    fill="tozeroy", fillcolor="rgba(155,126,184,0.15)"
))
fig2.add_trace(go.Scatter(
    x=df["month"], y=df["n_senior_ii"] + df["n_seniors"],
    name="+ Seniors", mode="lines",
    line=dict(color="#c9a84c", width=2),
    fill="tonexty", fillcolor="rgba(201,168,76,0.15)"
))
fig2.add_trace(go.Scatter(
    x=df["month"], y=df["total_staff"],
    name="Total Staff", mode="lines",
    line=dict(color="#e8e4d9", width=2),
    fill="tonexty", fillcolor="rgba(126,184,201,0.15)"
))
fig2.add_trace(go.Scatter(
    x=df["month"], y=df["n_legacy"],
    name="Legacy Juniors Remaining", mode="lines",
    line=dict(color="#e8734a", width=2, dash="dot"),
))

if restructuring_month:
    fig2.add_vline(x=restructuring_month, line_width=2, line_color="#e8734a",
                   line_dash="dash", annotation_text="Restructuring",
                   annotation_position="top", annotation_font_color="#e8734a")

for y in range(1, sim_years + 1):
    fig2.add_vline(x=y * 12, line_width=1, line_color="#2a2a3a")

fig2.update_layout(
    paper_bgcolor="#0f0f14", plot_bgcolor="#0f0f14",
    font=dict(color="#e8e4d9", family="Georgia"),
    xaxis=dict(title="Month", gridcolor="#2a2a3a"),
    yaxis=dict(title="Number of Staff", gridcolor="#2a2a3a"),
    legend=dict(bgcolor="#1a1a24", bordercolor="#2a2a3a"),
    height=320, margin=dict(l=80, r=20, t=40, b=40),
    hoverlabel=dict(bgcolor="#1a1a24"),
)
st.plotly_chart(fig2, use_container_width=True)

# â”€â”€ Year by year summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.markdown("---")
st.subheader("Year by Year Summary")

yearly = df.groupby("year").agg(
    Avg_SeniorII=("n_senior_ii", "mean"),
    Avg_Seniors=("n_seniors", "mean"),
    Avg_Juniors=("n_juniors", "mean"),
    Avg_Total=("total_staff", "mean"),
    YearEnd_Bill=("total_cost", "last"),
    SeniorII_Cost=("senior_ii_cost", "last"),
    Senior_Cost=("senior_cost", "last"),
    Junior_Cost=("junior_cost", "last"),
).reset_index()

for col in ["Avg_SeniorII", "Avg_Seniors", "Avg_Juniors", "Avg_Total"]:
    yearly[col] = yearly[col].round(1)
for col in ["YearEnd_Bill", "SeniorII_Cost", "Senior_Cost", "Junior_Cost"]:
    yearly[col] = yearly[col].apply(lambda x: f"${x:,.0f}")

yearly.columns = ["Year", "Avg Senior II", "Avg Seniors", "Avg Juniors",
                  "Avg Total", "Year-End Bill", "Senior II Cost", "Senior Cost", "Junior Cost"]
st.dataframe(yearly, use_container_width=True, hide_index=True)

# â”€â”€ Event log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

st.markdown("---")
with st.expander("Show event log"):
    event_df = pd.DataFrame(events)
    event_df["Year"] = (event_df["month"] // 12) + 1
    event_df["Month of Year"] = event_df["month"] % 12 + 1
    event_df = event_df.rename(columns={"month": "Overall Month", "event": "Event"})
    event_df = event_df[["Year", "Month of Year", "Overall Month", "Event"]]
    st.dataframe(event_df, use_container_width=True, hide_index=True)
